var SR=(function(module,$){'use strict';var defaults={classes:'',content:'',width:640,height:480},Overlay=function(options){if(!arguments.length)return;options=$.extend({},defaults,options);this.$overlay=$('<div/>',{'class':'overlay','click':$.proxy(this,'close')});this.$lightbox=$('<div/>',{'class':'lightbox','click':function(event){event.stopPropagation();}});this.$content=$('<div/>',{'class':'content','html':options.content});this.$close=$('<a/>',{'class':'overlay_close','text':'x','click':$.proxy(this,'close')});this.$lightbox
.append(this.$close)
.append(this.$content);this.$overlay
.addClass(options.classes)
.append(this.$lightbox);$('body')
.append(this.$overlay);$(SR).on('pressedEscape',$.proxy(this,'close'));this.setDimensions(options.width,options.height);},Ajax=function(options,callback){Overlay.call(this,options);this.load(options.url,callback);},Iframe=function(options,callback){Overlay.call(this,options);this.load(options.url,callback);};Overlay.prototype.open=function(){this.$overlay.removeClass('overlay_inactive');this.$overlay.addClass('overlay_active');this.center();};Overlay.prototype.close=function(){this.$overlay.removeClass('overlay_active');this.$overlay.addClass('overlay_inactive');};Overlay.prototype.destroy=function(){this.$overlay.remove();};Overlay.prototype.setDimensions=function(width,height){this.$lightbox.css({'width':width+'px','height':height+'px'});};Overlay.prototype.center=function(){var $w=$(window),width=this.$lightbox.width(),height=this.$lightbox.height(),top=Math.ceil(($w.height()-height)/2),left=Math.ceil(($w.width()-width)/2);if(this.$overlay.css('position')==='absolute'){top+=$w.scrollTop();left+=$w.scrollLeft();}
this.$lightbox.css({'margin-top':top+'px','margin-left':left+'px'});};Overlay.prototype.autoFit=function(width,height){var availWidth=$(window).width(),availHeight=$(window).height(),fitWithin=availWidth,scaleDimension=width,ratio;if(availHeight<=availWidth){scaleDimension=height;fitWithin=availHeight;}
ratio=fitWithin/(scaleDimension+(fitWithin*0.5));width=Math.ceil(width*ratio);height=Math.ceil(height*ratio);this.setDimensions(width,height);this.center();};Ajax.prototype=new Overlay();Iframe.prototype=new Overlay();Ajax.prototype.load=function(url,callback){var me=this;this.$overlay.addClass('loading');this.$content.load(url,function(){me.$overlay.removeClass('loading');callback&&callback.call(me);});return this;};Iframe.prototype.load=function(url,callback){var me=this;this.$overlay.addClass('loading');this.$content.html($('<iframe/>',{'frameborder':0,'class':'content','src':url,'load':function(){me.$overlay.removeClass('loading');callback&&callback.call(me);}}));return this;};module.overlay={Overlay:Overlay,Ajax:Ajax,Iframe:Iframe};return module;}(SR||{},jQuery));
SR.overlay=(function(module,$){'use strict';var markup=function(images){var html='<div class="gallery_images">',num=images.length,entities=new SR.HTMLEntities(),i=0;for(;i<num;i++){html+='<div class="gallery_image">';if(images[i].mediatype=="video"){html+='<iframe width="640" height="480" src="https://www.youtube.com/embed/'+images[i].youtubeid+'" frameborder="0" allowfullscreen></iframe>';}
else{html+='<img src="'+images[i].url+'">';if(images[i].caption){html+='<span class="gallery_caption">'
+entities.encode(images[i].caption)
+'</span>';}}
html+='</div>';}
if(num>1){html+='<a class="gallery_dir gallery_prev"> &laquo; </a>'
+'<a class="gallery_dir gallery_next"> &raquo; </a>';}
html+='</div>';return html;},Gallery=function(images){SR.overlay.Overlay.call(this,{classes:'gallery',content:markup(images),width:640,height:480});this.activeImage=0;this.noOfImages=images.length;this.$images=this.$lightbox.find('.gallery_image');this.$lightbox.find('.gallery_prev').click($.proxy(this,'prev'));this.$lightbox.find('.gallery_next').click($.proxy(this,'next'));this.$overlay.addClass('loading');this.imagesdata=images;};Gallery.prototype=new SR.overlay.Overlay();Gallery.prototype.prev=function(){this.show(this.activeImage-1);};Gallery.prototype.next=function(){this.show(this.activeImage+1);};Gallery.prototype.show=function(index){var $image,image,autoFit,me=this;index=((index+1)>this.noOfImages)?0:index
index=(index<0)?(this.noOfImages-1):index;this.activeImage=index;$image=this.$images.filter(':eq('+index+')');this.$images.hide();$image.show();this.open();if(this.imagesdata[index].mediatype=='video'){this.autoFit(640,480);}
else{image=new Image();image.src=$image.children('img').attr('src');autoFit=function(){me.autoFit(image.width,image.height);};if(image.complete)autoFit();else image.onload=autoFit;}};module.Gallery=Gallery;return module;}(SR.overlay||{},jQuery));
SR.listing=(function(module,$){'use strict';var gaTrackingLabel='advert detail page';var coords={};var $photos;var gallery;var areaInfo;var mapOverlay;var map;var marker;var $map;var init=function(options){coords=options.coords;$map=$('#map');$photos=$('.photos .img');$photos[0]&&(new Image().src=$photos[0].getAttribute('href'));addEvents();};var addEvents=function(){$photos.click(showPhoto);if(coords){$('.map_link').click(showMap);}
$('a[rel="where_to_live_wizard"]').click(showAreaInfo);$('#looking_in').each(function(){var max=4;var index=max-2;if($(this).find("li").length>max){$(this)
.find('li:gt('+index+')')
.hide()
.end()
.append($('<li><a href="#">See more...</a></li>').click(function(){$(this).siblings(':hidden').show().end().remove();return false;}));}});};var photoGallery=function(){var photos=[];$photos.each(function(){var $photo=$(this);photos.push({caption:$photo.attr('title'),url:$photo.attr('href'),mediatype:$photo.data('mediatype'),youtubeid:$photo.data('youtubeid')});});gallery=new SR.overlay.Gallery(photos);};var showPhoto=function(){var index=$(this).data('number')-1;if(!(gallery instanceof SR.overlay.Gallery)){photoGallery();}
gallery.show(index<0?0:index);return false;};var showMap=function(){SR.tracking.trackEvent(SR.settings.gaCategoryMapEvents,'map clicked',gaTrackingLabel);if(!(mapOverlay instanceof SR.overlay.Overlay)){mapOverlay=new SR.overlay.Overlay({width:500,height:400,classes:'map',content:$map});}
mapOverlay.open();mapOverlay.autoFit(500,400);if(map){map.setCenter({lat:parseFloat(coords.lat),lng:parseFloat(coords.lon)});google.maps.event.trigger(map,'resize');}else{renderMap();}
return false;};var renderMap=function(){SR.map.loadMapsApi(gaTrackingLabel)
.then(function(){map=new SR.map.Map($map.attr('id'),coords,{zoom:14},gaTrackingLabel);var markerOptions=SR.map.getMarkerOptions();markerOptions.position=map.getCenter();marker=new google.maps.Marker(markerOptions);SR.map.addGaTracking();});};var showAreaInfo=function(){if(!(areaInfo instanceof SR.overlay.Iframe)){areaInfo=new SR.overlay.Iframe({classes:'area_info',url:$(this).attr('href'),width:400,height:300});}
areaInfo.open();return false;};module.detail={init:init,renderMap:renderMap};return module;}(SR.listing||{},jQuery));
